<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/funciones.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
   
</head>
<body>
   &nbsp;
    <div class="container">
        <div class="header-container d-flex justify-content-between align-items-start">
            <div class="col-1">
                <a href="/proyectos" class="border-0 bg-transparent">
                    <img src="{{ url_for('static', filename='img/back-icon.png') }}" alt="Macronutrientes" style="width: 30px; height: 30px;">
                </a>
            </div>
            
            <div class="d-flex flex-column align-items-end">
                <a href="/funciones/resumen" class="btn btn-resumen mb-2">Resumen del Proyecto</a>
                <a href="/chatbot/agente" class="btn btn-resumen">Asistente del proyecto</a>
            </div>
        </div>
        
        <h3>Funcionalidades del proyecto "{{project.name}}"</h3>
        &nbsp;
        <!-- Fase 1 - Siempre disponible -->
        <h2 class="row proyecto">Fase 1</h2>
        &nbsp;
        <div class="card-row">
            <div class="card-col">
                {% with imagen=url_for('static', filename='img/IdeaInicial.jpg'), titulo="Idea Inicial", url="/funciones/Fase1/formularios/IdeaInicial" %}
                {% include 'funciones/noticia.html' %}
                {% endwith %}
            </div>

            <div class="card-col">
                {% with imagen=url_for('static', filename='img/empatizar.jpg'), titulo="Empatizar con el usuario", url="/funciones/Fase1/formularios/empatizar"%}
                {% include 'funciones/noticia.html' %}
                {% endwith %}
            </div>

            <div class="card-col">
                {% with imagen=url_for('static', filename='img/quimico.jpg'), titulo="Composición Química", url="/funciones/Fase1/composicionQuimica" %}
                {% include 'funciones/noticia.html' %}
                {% endwith %}
            </div>

            <div class="card-col">
                {% with imagen=url_for('static', filename='img/estudio-mercado.png'), titulo="Estudio del mercado", url="/funciones/Fase1/estudioMercado"%}
                {% include 'funciones/noticia.html' %}
                {% endwith %}
            </div>
            
            <div class="card-col">
                {% with imagen=url_for('static', filename='img/ingredientes-sustentables.jpg'), titulo="Matriz de ingredientes sustentables", url="/funciones/Fase1/matrizSustentable"%}
                {% include 'funciones/noticia.html' %}
                {% endwith %}
            </div>
            
            <div class="card-col">
                {% with imagen=url_for('static', filename='img/ideacion.jpg'), titulo="Ideación", url="/funciones/Fase1/formularios/ideacion"%}
                {% include 'funciones/noticia.html' %}
                {% endwith %}
            </div>

            <div class="card-col">
                {% with imagen=url_for('static', filename='img/diseño-experimental.jpg'), titulo="Diseño experimental", url="/funciones/Fase1/diseñoExperimental"%}
                {% include 'funciones/noticia.html' %}
                {% endwith %}
            </div>
            
            <div class="card-col">
                {% with imagen=url_for('static', filename='img/macros.png'), titulo="Primer Prototipo", url="/funciones/Fase1/prototipado"%}
                {% include 'funciones/noticia.html' %}
                {% endwith %}
            </div>
        </div>
         &nbsp;
        <div class="avance-fase-container">
            <a href="/funciones/evaluacionAvance">Evaluación Avance de la Fase 1</a>
        </div>
         &nbsp;
        
        <!-- Fase 2 - Disponible si evaluacion_avance.avance is True -->
        <div class="{% if not evaluacion_avance or not evaluacion_avance.avance %}fase-bloqueada{% endif %}">
            <h2 class="row proyecto">Fase 2</h2>
            &nbsp;
            <div class="card-row">
                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/prototipo.webp'), titulo="Prototipo Medio", url="/funciones/Fase2/prototipoMedio" %}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>
    
                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/coste.jpg'), titulo="Simulación de coste", url="/funciones/Fase2/simulacionCostes"%}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>
    
                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/normativa.jpg'), titulo="Viabilidad normativa", url="/funciones/Fase2/analisisNormativo" %}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>
    
                <div class="card-col" id="empaque">
                    {% with imagen=url_for('static', filename='img/empaque.webp'), titulo="Prototipo de empaquetado", url="/funciones/Fase2/empaque"%}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>
            </div>
             &nbsp;
            <div class="avance-fase-container">
                <a href="/funciones/evaluacionAvance/Fase2">Evaluación Avance de la Fase 2</a>
            </div>
        </div>
         &nbsp;
        <!-- Fase 3 - Disponible si evaluacion_avance.avance2 is True -->
        <div class="{% if not evaluacion_avance or not evaluacion_avance.avance2 %}fase-bloqueada{% endif %}">
            <h2 class="row proyecto">Fase 3</h2>
            &nbsp;
            <div class="card-row">
                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/experiencia.webp'), titulo="Prototipado y resultados de primera experiencia", url="/funciones/Fase3/prototipoFinal" %}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>

                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/simulacion_produccion.jpg'), titulo="Simulación de producción", url="/funciones/Fase3/simulacionProduccion"%}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>
        
                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/precio.png'), titulo="Actualización Precios Alimentos", url="/funciones/Fase3/preciosIngredientes"%}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>
        
                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/gastos.jpg'), titulo="Simulación de Cálculo de gastos", url="/funciones/Fase3/calculoGastos" %}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>
        
                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/sensorial.jpg'), titulo="Análisis sensorial", url="/funciones/Fase3/analisisSensorial"%}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>
                
                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/composicion_nutricional.webp'), titulo="Validación composición nutricional", url="/funciones/Fase3/validacionNutricional" %}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>
        
                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/escalamiento.gif'), titulo="Escalamiento", url="/funciones/Fase3/escalamiento"%}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>
        
                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/costo_produccion.jpg'), titulo="Validación costos producción", url="/funciones/Fase3/calculoGastos/validacionCostos" %}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>
        
                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/empaque_final.jpg'), titulo="Prototipo empaque alta fidelidad", url="/funciones/Fase3/empaqueFidelidad"%}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>
            </div>
             &nbsp;
            <div class="avance-fase-container">
                <a href="/funciones/evaluacionAvance/Fase3">Evaluación Avance de la Fase 3</a>
            </div>
        </div>
         &nbsp;
        <!-- Fase 4 - Disponible si evaluacion_avance.avance3 is True -->
        <div class="{% if not evaluacion_avance or not evaluacion_avance.avance3 %}fase-bloqueada{% endif %}">
            <h2 class="row proyecto">Fase 4</h2>
            &nbsp;
            <div class="card-row">
                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/parametrosSustentables.jpg'), titulo="Medición parámetros de sustentabilidad inicial lista de chequeo", url="/funciones/Fase4/chequeo" %}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>

                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/estudioVidaUtil.jpg'), titulo="Estudio de vida útil", url="/funciones/Fase4/vidaUtil"%}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>
        
                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/analisisSensorial2.webp'), titulo="Análisis sensorial 2", url="/funciones/Fase4/analisisSensorial2"%}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>
        
                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/empaqueFinal.jpg'), titulo="Validación de empaques", url="/funciones/Fase4/validacionEmpaque" %}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>
                
                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/sustentable.jpg'), titulo="Medición parámetros de sustentabilidad", url="/funciones/Fase4/parametrosSustentables" %}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>
        
                <div class="card-col">
                    {% with imagen=url_for('static', filename='img/analisisSensorial3.jpg'), titulo="Análisis sensorial 3", url="/funciones/Fase4/analisisSensorial2/aceptacion"%}
                    {% include 'funciones/noticia.html' %}
                    {% endwith %}
                </div>
            </div>

             &nbsp;
            
            <div class="avance-fase-container">
                <a href="/funciones/evaluacionAvance/Fase4">Evaluación Avance de la Fase 4</a>
            </div>
        </div>
    </div>
    <script>
// Versión turbo - guarda posición inmediatamente antes de navegar
(function() {
  // Guardar posición en cuanto se hace clic
  document.addEventListener('click', function(e) {
    if (e.target.closest('a') || e.target.closest('button[type="submit"]')) {
      sessionStorage.setItem('scrollPos', window.pageYOffset || document.documentElement.scrollTop);
    }
  }, true); // Usamos capture: true para atrapar el evento pronto

  // Restaurar posición LO ANTES POSIBLE
  document.addEventListener('DOMContentLoaded', function() {
    const savedPos = sessionStorage.getItem('scrollPos');
    if (savedPos) {
      document.documentElement.scrollTop = savedPos;
      sessionStorage.removeItem('scrollPos');
    }
  });
})();
</script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>