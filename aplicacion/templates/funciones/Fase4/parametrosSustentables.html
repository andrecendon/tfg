<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Parámetros de Producción Sustentable</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .card {
            border: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .card-header {
            background-color: #2c3e50;
            color: white;
            border-bottom: 1px solid #e9ecef;
            font-weight: 600;
        }
        h2 {
            color: #2c3e50;
            font-weight: 700;
        }
        .parametro-row {
            border-bottom: 1px solid #eee;
            padding: 15px 0;
        }
        .parametro-row:last-child {
            border-bottom: none;
        }
        .unidad {
            color: #6c757d;
            font-size: 0.9em;
        }
        #submitBtn {
            background-color: #2c3e50;
            border: none;
            padding: 10px 25px;
        }
        #submitBtn:hover {
            background-color: #1a252f;
        }
        .form-control:focus {
            border-color: #2c3e50;
            box-shadow: 0 0 0 0.25rem rgba(44, 62, 80, 0.25);
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <form id="parametrosForm" method="POST" action="/funciones/Fase4/parametrosSustentables/guardar">
            <div class="row">
                <div class="col-1">
                    <button type="submit" name="action" value="back" class="border-0 bg-transparent">
                        <img src="{{ url_for('static', filename='img/back-icon.png') }}" alt="Volver" style="width: 30px; height: 30px;">
                    </button>
                </div>
            </div>
            <h2 class="mb-4 text-center">Registro de Parámetros de Producción Sustentable</h2>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5>Indicadores Ambientales</h5>
            </div>
            <div class="card-body">
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="agua" class="form-label">Consumo de agua</label>
                        <span class="unidad">(m³/mes)</span>
                    </div>
                    <div class="col-md-6">
                        <input type="number" step="0.01" class="form-control" id="agua" name="agua" 
                               value="{{ project.parametros_sustentables.consumo_agua   }}" placeholder="Ej: 120.5">
                    </div>
                </div>
                
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="electricidad" class="form-label">Consumo de electricidad</label>
                        <span class="unidad">(kWh/mes)</span>
                    </div>
                    <div class="col-md-6">
                        <input type="number" step="0.01" class="form-control" id="electricidad" name="electricidad" 
                               value="{{ project.parametros_sustentables.consumo_electricidad   }}" placeholder="Ej: 1500">
                    </div>
                </div>
                
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="gas" class="form-label">Consumo de gas licuado</label>
                        <span class="unidad">(L/mes)</span>
                    </div>
                    <div class="col-md-6">
                        <input type="number" step="0.01" class="form-control" id="gas" name="gas" 
                               value="{{ project.parametros_sustentables.consumo_gas_licuado   }}" placeholder="Ej: 45.2">
                    </div>
                </div>
                
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="materia_prima" class="form-label">Materia prima usada</label>
                        <span class="unidad">(kg/mes)</span>
                    </div>
                    <div class="col-md-6">
                        <input type="number" step="0.01" class="form-control" id="materia_prima" name="materia_prima" 
                               value="{{ project.parametros_sustentables.materia_prima_usada   }}" placeholder="Ej: 850">
                    </div>
                </div>
                
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="empaques" class="form-label">Uso de empaques</label>
                        <span class="unidad">(kg/mes)</span>
                    </div>
                    <div class="col-md-6">
                        <input type="number" step="0.01" class="form-control" id="empaques" name="empaques" 
                               value="{{ project.parametros_sustentables.uso_empaques}}" placeholder="Ej: 120">
                    </div>
                </div>
                
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="residuos_solidos" class="form-label">Residuos sólidos generados</label>
                        <span class="unidad">(kg/mes)</span>
                    </div>
                    <div class="col-md-6">
                        <input type="number" step="0.01" class="form-control" id="residuos_solidos" name="residuos_solidos" 
                               value="{{ project.parametros_sustentables.residuos_solidos_generados }}" placeholder="Ej: 210">
                    </div>
                </div>
                
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="residuos_liquidos" class="form-label">Residuos líquidos</label>
                        <span class="unidad">(L/mes)</span>
                    </div>
                    <div class="col-md-6">
                        <input type="number" step="0.01" class="form-control" id="residuos_liquidos" name="residuos_liquidos" 
                               value="{{ project.parametros_sustentables.residuos_liquidos   }}" placeholder="Ej: 350">
                    </div>
                </div>
                
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="co2_directo" class="form-label">Emisiones directas de CO₂</label>
                        <span class="unidad">(kg/mes)</span>
                    </div>
                    <div class="col-md-6">
                        <input type="number" step="0.01" class="form-control" id="co2_directo" name="co2_directo" 
                               value="{{ project.parametros_sustentables.emisiones_directas_co2   }}" placeholder="Ej: 420">
                    </div>
                </div>
                
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="co2_indirecto" class="form-label">Emisiones indirectas por electricidad</label>
                        <span class="unidad">(kg CO₂/mes)</span>
                    </div>
                    <div class="col-md-6">
                        <input type="number" step="0.01" class="form-control" id="co2_indirecto" name="co2_indirecto" 
                               value="{{ project.parametros_sustentables.emisiones_indirectas_electricidad   }}" placeholder="Ej: 380">
                    </div>
                </div>
                
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="subproductos" class="form-label">Subproductos valorizados</label>
                        <span class="unidad">(kg/mes)</span>
                    </div>
                    <div class="col-md-6">
                        <input type="number" step="0.01" class="form-control" id="subproductos" name="subproductos" 
                               value="{{ project.parametros_sustentables.subproductos_valorizados   }}" placeholder="Ej: 150">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5>Logística y Transporte</h5>
            </div>
            <div class="card-body">
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="km_recorridos" class="form-label">Km recorridos para insumos</label>
                        <span class="unidad">(km/mes)</span>
                    </div>
                    <div class="col-md-6">
                        <input type="number" step="0.01" class="form-control" id="km_recorridos" name="km_recorridos" 
                               value="{{ project.parametros_sustentables.km_recorridos_insumos   }}" placeholder="Ej: 1250">
                    </div>
                </div>
                
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="tipo_transporte" class="form-label">Tipo de transporte principal</label>
                    </div>
                    <div class="col-md-6">
                        <select class="form-select" id="tipo_transporte" name="tipo_transporte">
                            <option value="">Seleccione...</option>
                            <option value="Camión refrigerado" {% if project.parametros_sustentables.tipo_transporte_principal == 'Camión refrigerado' %}selected{% endif %}>Camión refrigerado</option>
                            <option value="Camión seco" {% if project.parametros_sustentables.tipo_transporte_principal == 'Camión seco' %}selected{% endif %}>Camión seco</option>
                            <option value="Furgoneta" {% if project.parametros_sustentables.tipo_transporte_principal == 'Furgoneta' %}selected{% endif %}>Furgoneta</option>
                            <option value="Barco" {% if project.parametros_sustentables.tipo_transporte_principal == 'Barco' %}selected{% endif %}>Barco</option>
                            <option value="Avión" {% if project.parametros_sustentables.tipo_transporte_principal == 'Avión' %}selected{% endif %}>Avión</option>
                            <option value="Otro" {% if project.parametros_sustentables.tipo_transporte_principal and 
                                                 project.parametros_sustentables.tipo_transporte_principal not in ['Camión refrigerado', 'Camión seco', 'Furgoneta', 'Barco', 'Avión'] %}selected{% endif %}>Otro</option>
                        </select>
                    </div>
                </div>
                
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="carga_transportada" class="form-label">Carga total transportada</label>
                        <span class="unidad">(kg/mes)</span>
                    </div>
                    <div class="col-md-6">
                        <input type="number" step="0.01" class="form-control" id="carga_transportada" name="carga_transportada" 
                               value="{{ project.parametros_sustentables.carga_total_transportada   }}" placeholder="Ej: 5000">
                    </div>
                </div>
                
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="ubicacion_proveedores" class="form-label">Ubicación de proveedores</label>
                    </div>
                    <div class="col-md-6">
                        <input type="text" class="form-control" id="ubicacion_proveedores" name="ubicacion_proveedores" 
                               value="{{ project.parametros_sustentables.ubicacion_proveedores or ''  }}" placeholder="Ej: 70% regional, 30% nacional">
                    </div>
                </div>
                
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="origen_insumos" class="form-label">Origen de insumos</label>
                        <span class="unidad">(% local / % importado)</span>
                    </div>
                    <div class="col-md-3">
                        <input type="number" min="0" max="100" class="form-control" id="origen_local" name="origen_local" 
                               value="{{ project.parametros_sustentables.origen_insumos_local   }}" placeholder="% local">
                    </div>
                    <div class="col-md-3">
                        <input type="number" min="0" max="100" class="form-control" id="origen_importado" name="origen_importado" 
                               value="{{ project.parametros_sustentables.origen_insumos_importado   }}" placeholder="% importado">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5>Producción y Eficiencia</h5>
            </div>
            <div class="card-body">
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="produccion_mensual" class="form-label">Producción mensual</label>
                        <span class="unidad">(kg de batido/mes)</span>
                    </div>
                    <div class="col-md-6">
                        <input type="number" step="0.01" class="form-control" id="produccion_mensual" name="produccion_mensual" 
                               value="{{ project.parametros_sustentables.produccion_mensual_batido   }}" placeholder="Ej: 2500">
                    </div>
                </div>
                
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="mermas" class="form-label">Mermas de proceso</label>
                        <span class="unidad">(%)</span>
                    </div>
                    <div class="col-md-6">
                        <input type="number" step="0.01" min="0" max="100" class="form-control" id="mermas" name="mermas" 
                               value="{{ project.parametros_sustentables.mermas_proceso   }}" placeholder="Ej: 5.2">
                    </div>
                </div>
                
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="productos_limpieza" class="form-label">Uso de productos de limpieza</label>
                        <span class="unidad">(L/mes)</span>
                    </div>
                    <div class="col-md-6">
                        <input type="number" step="0.01" class="form-control" id="productos_limpieza" name="productos_limpieza" 
                               value="{{ project.parametros_sustentables.uso_productos_limpieza   }}" placeholder="Ej: 25">
                    </div>
                </div>
                
                <div class="parametro-row row align-items-center">
                    <div class="col-md-6">
                        <label for="energia_renovable" class="form-label">Consumo energía renovable</label>
                        <span class="unidad">(kWh/mes)</span>
                    </div>
                    <div class="col-md-6">
                        <input type="number" step="0.01" class="form-control" id="energia_renovable" name="energia_renovable" 
                               value="{{ project.parametros_sustentables.consumo_energia_renovable   }}" placeholder="Ej: 300">
                    </div>
                </div>
            </div>
        </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                        <button type="submit" name="action" value="guardar" class="btn btn-primary">Guardar Parámetros</button>
                    </div>
                </div>
            </div>
            &nbsp;
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Validación para asegurar que la suma de % local + % importado no exceda 100
        document.getElementById('parametrosForm').addEventListener('submit', function(e) {
            const local = parseFloat(document.getElementById('origen_local').value) || 0;
            const importado = parseFloat(document.getElementById('origen_importado').value) || 0;
            
            if (local + importado > 100) {
                e.preventDefault();
                alert('La suma del porcentaje local e importado no puede exceder el 100%');
                document.getElementById('origen_local').focus();
            }
        });
    </script>
</body>
</html>